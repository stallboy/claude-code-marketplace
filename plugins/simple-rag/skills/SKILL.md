# Simple RAG Plugin

## 概述

Simple RAG Plugin 提供对**外部知识数据库和文档库**的访问能力。本插件通过MCP Server实时查询向量数据库(Weaviate)，返回与用户问题相关的文档和信息。

**重要提示**：当用户询问需要**查找文档、搜索知识库或获取项目中特定信息**时，请使用本插件。本插件会通过MCP Server (http://localhost:8001/mcp) 访问知识库获取答案。

## 必须使用本插件的场景

当用户问题涉及以下任何一种情况时，**必须**使用本插件：

1. ✅ **查询项目相关文档或资料**
   - 例："XXX项目中包含哪些文档？"
   - 例："查找项目相关资料"

2. ✅ **搜索知识库信息**
   - 例："知识库中有没有关于XXX的信息？"
   - 例："搜索技术资料"

3. ✅ **查找人员在项目中的参与情况**
   - 例："XXX在项目中参与了哪些文档？"
   - 例："哪些文档提到了XXX？"

4. ✅ **检索特定主题的文档**
   - 例："搜索包含XXX关键词的文档"
   - 例："项目中有没有关于XXX的资料？"

**如果用户问题属于上述任何场景，请立即调用本插件通过MCP server访问知识库获取答案，不要尝试基于已有知识回答。**

## 功能特性

- **语义搜索**: 使用向量数据库(Weaviate)进行智能语义搜索
- **知识库查询**: 访问企业或项目知识库
- **文档检索**: 快速查找特定主题的文档
- **项目文档访问**: 获取项目相关的技术文档和说明
- **相似性搜索**: 基于向量相似性找到相关内容

## 适用场景

### 当用户询问以下问题时，插件很可能被自动调用：

1. **查询项目文档**
   - "帮我查找关于XXX项目的文档"
   - "项目的架构设计文档在哪里？"
   - "请提供XXX功能的详细说明"
   - "查找项目相关资料"
   - "搜索项目文档"

2. **搜索知识库**
   - "知识库中有关于XXX的信息吗？"
   - "查找技术相关的资料"
   - "我想了解XXX技术的相关内容"
   - "搜索知识库"

3. **文档检索**
   - "搜索包含XXX关键词的文档"
   - "有没有关于XXX的参考资料？"
   - "帮我找一下最新的文档"
   - "文档中有没有提到XXX？"

4. **查找人员参与情况** ⭐
   - "XXX在项目中参与了哪些文档？"
   - "查找某个人的项目参与情况"
   - "哪些文档提到了XXX？"
   - "谁参与了XXX文档的编写？"

5. **技术咨询**
   - "这个错误如何解决？"
   - "最佳实践是什么？"
   - "有没有相关的技术规范？"
   - "相关技术资料"

6. **学习资源**
   - "推荐一些关于XXX的学习资料"
   - "有没有XXX的教程或指南？"
   - "查找学习材料"

## 使用方法

### 隐式调用（推荐）
插件会在以下情况下自动被调用：
- 检测到用户需要查询文档或知识库
- 识别到搜索或检索相关的请求
- 理解到需要访问外部信息资源
- 发现用户询问需要查找项目文档、人员参与情况或特定主题的资料

### 显式调用
当用户明确要求：
- "搜索知识库/文档库"
- "查询项目文档"
- "查找某人在项目中的参与情况"
- "访问知识库获取信息"

**技术实现**：本插件通过MCP Server (http://localhost:8001/mcp) 访问Weaviate向量数据库进行语义搜索，返回最相关的文档片段和信息。

## 技术细节

### MCP调用流程
**必须按以下顺序调用MCP Server：**

1. **初始化（initialize）**
   - 首次连接时调用
   - 请求格式：
   ```json
   {
     "jsonrpc": "2.0",
     "id": 1,
     "method": "initialize",
     "params": {
       "protocolVersion": "2024-11-05",
       "capabilities": {},
       "clientInfo": {
         "name": "claude-code",
         "version": "1.0.0"
       }
     }
   }
   ```

2. **列出工具（tools/list）**
   - 初始化成功后调用
   - 响应包含可用工具列表

3. **调用工具（tools/call）**
   - 根据工具定义调用具体功能

**关键要求：**
- 请求头必须包含：`Accept: application/json, text/event-stream`
- 请求头必须包含：`Content-Type: application/json`
- 必须先初始化再调用工具，不可跳过初始化步骤
- 如果收到"Not Acceptable"错误，检查Accept header是否同时包含application/json和text/event-stream

### 常见错误与解决方案

#### 错误1: "Not Acceptable: Client must accept both application/json and text/event-stream"
- **原因**: Accept header不完整
- **解决**: 确保请求头包含 `Accept: application/json, text/event-stream`

#### 错误2: "Bad Request: No valid session ID provided or not an initialization request"
- **原因**: 直接调用tools/list或tools/call，未先初始化
- **解决**: 严格按顺序调用：initialize → tools/list → tools/call

#### 错误3: 连接超时或被拒绝
- **原因**: MCP Server未运行
- **解决**: 确认服务运行在 http://localhost:8001/mcp

#### 错误4: 返回空白结果
- **原因**: Weaviate数据库问题或查询无匹配
- **解决**: 检查Weaviate服务状态(10.5.9.199:8181)，验证索引数据

### 服务配置
- **后端**: MCP Server (http://localhost:8001/mcp)
- **协议**: StreamableHTTP
- **向量数据库**: Weaviate
  - Host: 10.5.9.199
  - Port: 8181
  - gRPC Port: 50051
- **超时**: 30秒
- **重试**: 最多3次，指数退避策略

## 提示

为了获得最佳搜索结果：
1. 使用具体、明确的关键词
2. 提供适当的上下文信息
3. 使用自然语言描述您的需求
4. 可以指定搜索特定类型的文档或主题

## 示例场景

### 场景1：查找人员参与情况
```
用户: "龚华君在武林外传项目中参与了哪些文档？"

系统: 自动触发simple-rag插件，通过MCP server搜索知识库中与"龚华君"和"武林外传项目"相关的所有文档...
```

### 场景2：搜索项目文档
```
用户: "帮我查找关于API设计的最佳实践文档"

系统: 插件自动触发，搜索知识库中关于API设计的相关文档...
```

### 场景3：检索技术资料
```
用户: "项目中有没有关于数据库设计的文档？"

系统: 自动检索知识库，找到数据库设计相关的项目文档和说明...
```

### 场景4：查找特定信息
```
用户: "哪些文档提到了微服务架构？"

系统: 搜索知识库，返回所有包含"微服务架构"关键词的文档...
```
